{"version":3,"file":"coursegoals.min.js","sources":["../src/coursegoals.js"],"sourcesContent":["import ModalForm from 'core_form/modalform';\nimport {get_string as getString} from 'core/str';\nimport * as Notification from 'core/notification';\n\nconst SELECTORS = {\n    COURSEGOALS_TAB_ID: '#cg_goals_tab',\n    DETAILS_ID: 'cg_details_maintab',\n    TASK_CHECKBOX_CLASS: '.cg-taskcb',\n    TASK_DETAILS_ACTIVE: 'data-td-active',\n};\n\nexport const initCourseGoalsTable = () => {\n    let themesInfoDetails = document.querySelectorAll('.taskinfo');\n    document.getElementById('btn_show_tasks_info').addEventListener('click', function(e){\n        themesInfoDetails.forEach(el => {\n            el.open = true;\n        });\n    });\n    document.getElementById('btn_hide_tasks_info').addEventListener('click', function(e){\n        themesInfoDetails.forEach(el => {\n            el.open = false;\n        });\n    });\n};\n\nexport const initCourseGoalsTab = (parentelement, appendorder = 'last') => {\n    try {\n        /* Move the widget to the header area */\n        let cg_tab = document.querySelector(SELECTORS.COURSEGOALS_TAB_ID);\n        let cg_parentnodes = parentelement.split(',');\n        for (let i in cg_parentnodes) {\n            let cg_pageheader = document.querySelector(cg_parentnodes[i]);\n            if (cg_pageheader) {\n                if (appendorder === 'first') {\n                    cg_pageheader.prepend(cg_tab);\n                } else if (appendorder === 'last') {\n                    cg_pageheader.appendChild(cg_tab);\n                } else {\n                    cg_pageheader.appendChild(cg_tab);\n                }\n                break;\n            }\n        }\n\n        let cg_details_id = SELECTORS.DETAILS_ID;\n        let cg_details_node = document.getElementById(cg_details_id);\n\n        let cg_localDetailsAreOpen = window.localStorage.getItem(\"details-\" + cg_details_id);\n        if (cg_localDetailsAreOpen == \"true\" || cg_localDetailsAreOpen == null) {\n            cg_details_node.setAttribute(\"open\", \"true\");\n        }\n\n        cg_tab.style.display = \"block\"; // show tab after it is ready\n\n        cg_details_node.addEventListener(\"toggle\", function(e){\n            let isOpen = event.target.getAttribute(\"open\");\n            window.localStorage.setItem(\"details-\" + cg_details_id, typeof(isOpen) === \"string\" ? \"true\" : \"false\");\n        });\n\n        let taskCheckboxDivs = document.querySelectorAll(SELECTORS.TASK_CHECKBOX_CLASS);\n        taskCheckboxDivs.forEach((cbdiv) => {\n            let taskdetailsdiv = document.querySelector('[data-taskref=\"'+cbdiv.dataset.taskid+'\"]');\n            cbdiv.addEventListener('mouseenter', function(e) {\n                let activetaskdetails = document.querySelector('['+SELECTORS.TASK_DETAILS_ACTIVE+'=\"active\"]');\n                if (activetaskdetails) {\n                    activetaskdetails.style.display = 'none';\n                    activetaskdetails.removeAttribute(SELECTORS.TASK_DETAILS_ACTIVE);\n                }\n                taskdetailsdiv.style.display = 'block';\n                taskdetailsdiv.setAttribute(SELECTORS.TASK_DETAILS_ACTIVE, 'active')\n            });\n\n            // cbdiv.addEventListener('mouseleave', function(e) {\n            //     taskdetailsdiv.style.display = 'none';\n            // });\n        });\n    }\n    catch (ignore) {}\n};\n\nexport const setupGoalModalForm = (elementSelector, formClass) => {\n    const elements = document.querySelectorAll(elementSelector);\n    elements.forEach((element) => {\n        element.addEventListener('click', function (e) {\n            e.preventDefault();\n            let action = e.target.getAttribute('data-action');\n            let title = this.getAttribute('data-title') || this.innerHTML;\n            let goalid = this.getAttribute('data-goalid');\n\n            const form = new ModalForm({\n                formClass,\n                args: {\n                    action: action,\n                    goalid: goalid,\n                },\n                modalConfig: {\n                    title: title,\n                    large: true,\n                },\n                saveButtonText: title,\n                returnFocus: e.target,\n            });\n            addDefaultFormSubmitListener(form);\n        })\n    });\n};\n\nexport const setupTaskModalForm = (elementSelector, formClass) => {\n    const elements = document.querySelectorAll(elementSelector);\n    elements.forEach((element) => {\n        element.addEventListener('click', function (e) {\n            e.preventDefault();\n            let action = e.target.getAttribute('data-action');\n            let title = this.getAttribute('data-title') || this.innerHTML;\n            let coursegoalid = this.getAttribute('data-coursegoalid');\n            let taskid = this.getAttribute('data-taskid');\n\n            const form = new ModalForm({\n                formClass,\n                args: {\n                    taskid: taskid,\n                    coursegoalid: coursegoalid,\n                    action: action,\n                },\n                modalConfig: {\n                    title: title,\n                    large: true,\n                },\n                saveButtonText: title,\n                returnFocus: e.target,\n            });\n            addDefaultFormSubmitListener(form);\n        })\n    });\n};\n\nexport const setupSectionModalForm = (elementSelector, formClass) => {\n    const elements = document.querySelectorAll(elementSelector);\n    elements.forEach((element) => {\n        element.addEventListener('click', function (e) {\n            e.preventDefault();\n            let action = e.target.getAttribute('data-action');\n            let title = this.getAttribute('data-title') || this.innerHTML;\n            let sectionid = this.getAttribute('data-sectionid');\n\n            const form = new ModalForm({\n                formClass,\n                args: {\n                    action: action,\n                    sectionid: sectionid,\n                },\n                modalConfig: {\n                    title: title,\n                    large: true,\n                },\n                saveButtonText: title,\n                returnFocus: e.target,\n            });\n            addDefaultFormSubmitListener(form);\n        })\n    });\n};\n\nexport const setupModals = (modals) => {\n    modals.forEach((modaldata) => {\n        console.log('setupModalsDeprecated, '+ modaldata.elementSelector);\n        let elements = document.querySelectorAll(modaldata.elementSelector);\n        elements.forEach((element) => {\n            element.addEventListener('click', function (e) {\n                let title = this.getAttribute('data-title') || this.innerHTML;\n                let formClass = modaldata.formClass;\n                let dataID = this.getAttribute('data-id') || null;\n                let dataParentID = this.getAttribute('data-parentid') || null;\n                let action = this.getAttribute('data-action') || null;\n                let form = new ModalForm({\n                    formClass,\n                    args: {\n                        action: action,\n                        dataid: dataID,\n                        dataparentid: dataParentID,\n                    },\n                    modalConfig: {\n                        title: title,\n                        large: true,\n                    },\n                    saveButtonText: title,\n                    returnFocus: e.target,\n                });\n                addDefaultFormSubmitListener(form);\n            });\n        });\n    });\n};\n\nconst addDefaultFormSubmitListener = (form) => {\n    form.addEventListener(form.events.FORM_SUBMITTED, (event) => {\n        if (event.detail.result) {\n            if (event.detail.returnaction) {\n                // todo\n            }\n            if (event.detail.redirecturl) {\n                document.location = event.detail.redirecturl;\n            } else {\n                window.location.reload();\n            }\n        } else {\n            Notification.addNotification({\n                type: 'error',\n                message: event.detail.errors.join('<br>')\n            });\n        }\n    });\n    form.show();\n};"],"names":["_modalform","Notification","_interopRequireWildcard","SELECTORS","themesInfoDetails","document","querySelectorAll","getElementById","addEventListener","e","forEach","el","open","parentelement","appendorder","cg_tab","querySelector","cg_parentnodes","split","i","cg_pageheader","prepend","appendChild","cg_details_id","cg_details_node","cg_localDetailsAreOpen","window","localStorage","getItem","setAttribute","style","display","isOpen","event","target","getAttribute","setItem","cbdiv","taskdetailsdiv","dataset","taskid","activetaskdetails","removeAttribute","ignore","elementSelector","formClass","element","preventDefault","action","title","this","innerHTML","goalid","form","ModalForm","args","modalConfig","large","saveButtonText","returnFocus","addDefaultFormSubmitListener","coursegoalid","sectionid","modals","modaldata","console","log","dataID","dataParentID","dataid","dataparentid","events","FORM_SUBMITTED","detail","result","returnaction","redirecturl","location","reload","addNotification","type","message","errors","join","show"],"mappings":"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"}